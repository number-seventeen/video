{"remainingRequest":"/Users/zbywjq/Desktop/cloudwork/VideoBatches/node_modules/babel-loader/lib/index.js!/Users/zbywjq/Desktop/cloudwork/VideoBatches/src/plugins/socket.js","dependencies":[{"path":"/Users/zbywjq/Desktop/cloudwork/VideoBatches/src/plugins/socket.js","mtime":1596418914797},{"path":"/Users/zbywjq/Desktop/cloudwork/VideoBatches/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zbywjq/Desktop/cloudwork/VideoBatches/node_modules/babel-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9jbGFzc0NhbGxDaGVjayBmcm9tICIvVXNlcnMvemJ5d2pxL0Rlc2t0b3AvY2xvdWR3b3JrL1ZpZGVvQmF0Y2hlcy9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY2xhc3NDYWxsQ2hlY2siOwppbXBvcnQgX2NyZWF0ZUNsYXNzIGZyb20gIi9Vc2Vycy96Ynl3anEvRGVza3RvcC9jbG91ZHdvcmsvVmlkZW9CYXRjaGVzL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jcmVhdGVDbGFzcyI7Cgp2YXIgTXlTb2NrZXQgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogIGZ1bmN0aW9uIE15U29ja2V0KHVybCwgb25tZXNzYWdlKSB7CiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgTXlTb2NrZXQpOwoKICAgIHRoaXMudXJsID0gdXJsOwogICAgdGhpcy5vbm1lc3NhZ2UgPSBvbm1lc3NhZ2U7CiAgICB0aGlzLndzID0gbnVsbDsKICAgIHRoaXMucmVjb25uZWN0Q291bnQgPSAwOwogICAgdGhpcy5rZWVwVGltZXIgPSAwOwogICAgdGhpcy5rZWVwVGltZU1TID0gNDAwMDA7CiAgfQoKICBfY3JlYXRlQ2xhc3MoTXlTb2NrZXQsIFt7CiAgICBrZXk6ICJjb25uZWN0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjb25uZWN0KCkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgdmFyIG9uY2xvc2UgPSBmdW5jdGlvbiBvbmNsb3NlKGV2ZW50KSB7CiAgICAgICAgY29uc29sZS5sb2coJ3dzIG9uY2xvc2UgPScsIGV2ZW50KTsKCiAgICAgICAgaWYgKF90aGlzLnJlY29ubmVjdENvdW50IDwgNSkgewogICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIF90aGlzLnJlY29ubmVjdENvdW50Kys7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCflvIDlp4vph43ov54nLCBfdGhpcy5yZWNvbm5lY3RDb3VudCk7CgogICAgICAgICAgICBfdGhpcy5jb25uZWN0KCk7CiAgICAgICAgICB9LCAxMDAwKTsKICAgICAgICB9CiAgICAgIH07CgogICAgICB2YXIgb25lcnJvciA9IGZ1bmN0aW9uIG9uZXJyb3IoZXZlbnQpIHsKICAgICAgICBjb25zb2xlLmxvZygnd3MgZXJyb3InLCBldmVudCk7IC8vIG1lc3NhZ2UuZXJyb3IoJ+abtOaWsOe8luebruWksei0pe+8gScpCiAgICAgIH07CgogICAgICB2YXIgb25tZXNzYWdlID0gZnVuY3Rpb24gb25tZXNzYWdlKGV2ZW50KSB7CiAgICAgICAgLy8gY29uc29sZS5sb2coJ3dzIG1lc3NhZ2UnLGV2ZW50KQogICAgICAgIF90aGlzLmtlZXBXZWJTb2NrZXQoKTsKCiAgICAgICAgaWYgKF90aGlzLm9ubWVzc2FnZSkgewogICAgICAgICAgX3RoaXMub25tZXNzYWdlKGV2ZW50KTsKICAgICAgICB9IC8vIGNvbW1pdCh0eXBlcy5QQVJTRV9TT0NLRVRfREFUQSxldmVudC5kYXRhKTsKCiAgICAgIH07CgogICAgICB2YXIgb25vcGVuID0gZnVuY3Rpb24gb25vcGVuKGV2ZW50KSB7CiAgICAgICAgY29uc29sZS5sb2coJ3dzIG9ub3BlbicsIGV2ZW50KTsKICAgICAgICBfdGhpcy5yZWNvbm5lY3RDb3VudCA9IDA7CgogICAgICAgIF90aGlzLmtlZXBXZWJTb2NrZXQoKTsKICAgICAgfTsgLy8gY29uc3QgeyB1c2VybmFtZSwgdWlkLCB0b2tlbiwgdGVuYW50aWQgfSA9IGRlZmF1bHRQYXJhbXM7CiAgICAgIC8vIGxldCBwYXJhbXMgPSBgP3VpZD0ke3VpZH0mdXNlcm5hbWU9JHt1c2VybmFtZX0mdG9rZW49JHt0b2tlbn0mdGVuYW50aWQ9JHt0ZW5hbnRpZH1gOwogICAgICAvLyBsZXQgcGFyYW1zID0gYD90b2tlbj0ke1V0aWwuY29uZmlnLmRlZmF1bHRQYXJhbXMudG9rZW59YDtwYXJhbXM9Jyc7CiAgICAgIC8vIHJldHVybiBXZWJTb2NrZXQuaW5pdFdlYlNvY2tldChVdGlsLmludGVyZmFjZU9iai53ZWJzb2NrZXQrcGFyYW1zLG9uTWVzc2FnZSxvbkVycm9yLG9uU3VjY2VzcyxvbkZhaWx1cmUsb25SZWNvbm5lY3QpOwoKCiAgICAgIHZhciBwcm90b2NvbCA9ICcnOwoKICAgICAgaWYgKGRvY3VtZW50LmxvY2F0aW9uLnByb3RvY29sID09ICJodHRwczoiKSB7CiAgICAgICAgcHJvdG9jb2wgPSAid3NzOi8vIiArIGRvY3VtZW50LmxvY2F0aW9uLmhvc3Q7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcHJvdG9jb2wgPSAid3M6Ly8iICsgZG9jdW1lbnQubG9jYXRpb24uaG9zdDsKICAgICAgfQoKICAgICAgY29uc29sZS5sb2coJ3Byb3RvY29sJywgcHJvdG9jb2wpOwogICAgICB2YXIgd3MgPSBuZXcgV2ViU29ja2V0KHByb3RvY29sICsgdGhpcy51cmwpOyAvL2NvbnNvbGUubG9nKCdzb2NrZXRVcmwnLHNvY2tldFVybCkKCiAgICAgIHdzLm9uY2xvc2UgPSBvbmNsb3NlOwogICAgICB3cy5vbmVycm9yID0gb25lcnJvcjsKICAgICAgd3Mub25tZXNzYWdlID0gb25tZXNzYWdlOwogICAgICB3cy5vbm9wZW4gPSBvbm9wZW47CiAgICAgIHRoaXMud3MgPSB3czsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJrZWVwV2ViU29ja2V0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBrZWVwV2ViU29ja2V0KCkgewogICAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICAgIGNsZWFyVGltZW91dCh0aGlzLmtlZXBUaW1lcik7CiAgICAgIHRoaXMua2VlcFRpbWVyID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkgewogICAgICAgIC8vIGlmKHRoaXMud3MucmVhZHlTdGF0ZSA9PSAxKXsKICAgICAgICAvLyAgICAgdGhpcy53cy5zZW5kKCdwaW5nJyk7CiAgICAgICAgLy8gfQogICAgICAgIF90aGlzMi5zZW5kTXNnKCdwaW5nJyk7CiAgICAgIH0sIHRoaXMua2VlcFRpbWVNUyk7CiAgICB9CiAgfSwgewogICAga2V5OiAic2VuZE1zZyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2VuZE1zZyhkYXRhKSB7CiAgICAgIGlmICh0aGlzLndzKSB7CiAgICAgICAgdGhpcy53cy5zZW5kKGRhdGEpOwogICAgICB9IC8vIGlmKHRoaXMud3MucmVhZHlTdGF0ZSA9PSAxKXsKICAgICAgLy8gfQoKICAgIH0KICB9XSk7CgogIHJldHVybiBNeVNvY2tldDsKfSgpOwoKZXhwb3J0IGRlZmF1bHQgTXlTb2NrZXQ7"},{"version":3,"sources":["/Users/zbywjq/Desktop/cloudwork/VideoBatches/src/plugins/socket.js"],"names":["MySocket","url","onmessage","ws","reconnectCount","keepTimer","keepTimeMS","onclose","event","console","log","setTimeout","connect","onerror","keepWebSocket","onopen","protocol","document","location","host","WebSocket","clearTimeout","setInterval","sendMsg","data","send"],"mappings":";;;IAAMA,Q;AACF,oBAAYC,GAAZ,EAAgBC,SAAhB,EAA0B;AAAA;;AACtB,SAAKD,GAAL,GAAWA,GAAX;AACA,SAAKC,SAAL,GAAiBA,SAAjB;AACA,SAAKC,EAAL,GAAU,IAAV;AACA,SAAKC,cAAL,GAAsB,CAAtB;AAEA,SAAKC,SAAL,GAAiB,CAAjB;AACA,SAAKC,UAAL,GAAkB,KAAlB;AACH;;;;8BAEQ;AAAA;;AACL,UAAMC,OAAO,GAAG,SAAVA,OAAU,CAACC,KAAD,EAAW;AACvBC,QAAAA,OAAO,CAACC,GAAR,CAAY,cAAZ,EAA2BF,KAA3B;;AACA,YAAG,KAAI,CAACJ,cAAL,GAAsB,CAAzB,EAA2B;AACvBO,UAAAA,UAAU,CAAC,YAAI;AACX,YAAA,KAAI,CAACP,cAAL;AACAK,YAAAA,OAAO,CAACC,GAAR,CAAY,MAAZ,EAAmB,KAAI,CAACN,cAAxB;;AACA,YAAA,KAAI,CAACQ,OAAL;AACH,WAJS,EAIR,IAJQ,CAAV;AAKH;AACJ,OATD;;AAWA,UAAMC,OAAO,GAAG,SAAVA,OAAU,CAACL,KAAD,EAAW;AACvBC,QAAAA,OAAO,CAACC,GAAR,CAAY,UAAZ,EAAuBF,KAAvB,EADuB,CAEvB;AACH,OAHD;;AAKA,UAAMN,SAAS,GAAG,SAAZA,SAAY,CAACM,KAAD,EAAW;AACzB;AACA,QAAA,KAAI,CAACM,aAAL;;AACA,YAAG,KAAI,CAACZ,SAAR,EAAkB;AACd,UAAA,KAAI,CAACA,SAAL,CAAeM,KAAf;AACH,SALwB,CAMzB;;AAEH,OARD;;AASA,UAAMO,MAAM,GAAG,SAATA,MAAS,CAACP,KAAD,EAAW;AACtBC,QAAAA,OAAO,CAACC,GAAR,CAAY,WAAZ,EAAwBF,KAAxB;AACA,QAAA,KAAI,CAACJ,cAAL,GAAsB,CAAtB;;AACA,QAAA,KAAI,CAACU,aAAL;AACH,OAJD,CA1BK,CAgCL;AACA;AACA;AACA;;;AAEA,UAAIE,QAAQ,GAAG,EAAf;;AACA,UAAGC,QAAQ,CAACC,QAAT,CAAkBF,QAAlB,IAA8B,QAAjC,EAA0C;AACtCA,QAAAA,QAAQ,GAAG,WAASC,QAAQ,CAACC,QAAT,CAAkBC,IAAtC;AACH,OAFD,MAGI;AACAH,QAAAA,QAAQ,GAAG,UAAQC,QAAQ,CAACC,QAAT,CAAkBC,IAArC;AACH;;AACDV,MAAAA,OAAO,CAACC,GAAR,CAAY,UAAZ,EAAuBM,QAAvB;AACA,UAAIb,EAAE,GAAG,IAAIiB,SAAJ,CAAcJ,QAAQ,GAAC,KAAKf,GAA5B,CAAT,CA7CK,CA6CqC;;AAE1CE,MAAAA,EAAE,CAACI,OAAH,GAAaA,OAAb;AACAJ,MAAAA,EAAE,CAACU,OAAH,GAAaA,OAAb;AACAV,MAAAA,EAAE,CAACD,SAAH,GAAeA,SAAf;AACAC,MAAAA,EAAE,CAACY,MAAH,GAAYA,MAAZ;AAEA,WAAKZ,EAAL,GAAUA,EAAV;AACH;;;oCAGc;AAAA;;AACXkB,MAAAA,YAAY,CAAC,KAAKhB,SAAN,CAAZ;AACA,WAAKA,SAAL,GAAiBiB,WAAW,CAAC,YAAI;AAC7B;AACA;AACA;AACA,QAAA,MAAI,CAACC,OAAL,CAAa,MAAb;AACH,OAL2B,EAK1B,KAAKjB,UALqB,CAA5B;AAMH;;;4BAEOkB,I,EAAK;AACT,UAAG,KAAKrB,EAAR,EAAW;AACP,aAAKA,EAAL,CAAQsB,IAAR,CAAaD,IAAb;AACH,OAHQ,CAIT;AAEA;;AACH;;;;;;AAGL,eAAexB,QAAf","sourcesContent":["class MySocket{\n    constructor(url,onmessage){\n        this.url = url;\n        this.onmessage = onmessage;\n        this.ws = null;\n        this.reconnectCount = 0;\n\n        this.keepTimer = 0;\n        this.keepTimeMS = 40000;\n    }\n\n    connect(){\n        const onclose = (event) => {\n            console.log('ws onclose =',event)\n            if(this.reconnectCount < 5){\n                setTimeout(()=>{\n                    this.reconnectCount++;\n                    console.log('开始重连',this.reconnectCount)\n                    this.connect();\n                },1000);\n            }\n        }\n\n        const onerror = (event) => {\n            console.log('ws error',event)\n            // message.error('更新编目失败！')\n        }\n\n        const onmessage = (event) => {\n            // console.log('ws message',event)\n            this.keepWebSocket();\n            if(this.onmessage){\n                this.onmessage(event);\n            }\n            // commit(types.PARSE_SOCKET_DATA,event.data);\n            \n        }\n        const onopen = (event) => {\n            console.log('ws onopen',event)\n            this.reconnectCount = 0;\n            this.keepWebSocket();\n        }\n\n        // const { username, uid, token, tenantid } = defaultParams;\n        // let params = `?uid=${uid}&username=${username}&token=${token}&tenantid=${tenantid}`;\n        // let params = `?token=${Util.config.defaultParams.token}`;params='';\n        // return WebSocket.initWebSocket(Util.interfaceObj.websocket+params,onMessage,onError,onSuccess,onFailure,onReconnect);\n\n        let protocol = ''\n        if(document.location.protocol == \"https:\"){\n            protocol = \"wss://\"+document.location.host\n        }\n        else{\n            protocol = \"ws://\"+document.location.host\n        }\n        console.log('protocol',protocol)\n        let ws = new WebSocket(protocol+this.url);//console.log('socketUrl',socketUrl)\n        \n        ws.onclose = onclose;\n        ws.onerror = onerror;\n        ws.onmessage = onmessage;\n        ws.onopen = onopen;\n\n        this.ws = ws;\n    }\n\n\n    keepWebSocket(){\n        clearTimeout(this.keepTimer);\n        this.keepTimer = setInterval(()=>{\n            // if(this.ws.readyState == 1){\n            //     this.ws.send('ping');\n            // }\n            this.sendMsg('ping');\n        },this.keepTimeMS)\n    }\n\n    sendMsg(data){\n        if(this.ws){\n            this.ws.send(data);\n        }\n        // if(this.ws.readyState == 1){\n            \n        // }\n    }\n}\n\nexport default MySocket;"]}]}
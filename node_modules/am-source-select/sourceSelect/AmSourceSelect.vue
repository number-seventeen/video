<template>
    <div class="am-source-select">
        <div class="ass-top">
            <!-- <TypeRadio :enabledType="enabledType" @change="sourceTypeHandler"/> -->
            <div class="ass-top-line2">
                <div class="filter-params-left">
                    <el-select class="fp-select" v-if="enabledType != 'audio'" v-model="typeSelectValue" size="small" placeholder="请选择" @change="typeSelectHandler">
                        <el-option
                        v-for="item in typeOptions"
                        :key="item.value"
                        :label="item.label"
                        :value="item.value"
                        :disabled="item.disabled">
                        </el-option>
                    </el-select>
                    <el-select class="fp-select2" v-show="typeSelectValue!=3" v-model="duraSelectValue" size="small"  placeholder="请选择" @change="duraSelectHandler">
                        <el-option
                        v-for="item in duraOptions"
                        :key="item.value"
                        :label="item.label"
                        :value="item.value"
                        :disabled="item.disabled">
                        </el-option>
                    </el-select>

                    <el-date-picker
                    class="fp-date-picker"
                    size="small"
                    v-model="dateRange"
                    type="datetimerange"
                    align="right"
                    unlink-panels
                    range-separator="至"
                    start-placeholder="开始日期"
                    end-placeholder="结束日期"
                    :picker-options="pickerOptions"
                    @change="dateChangeHandler">
                    </el-date-picker>
                </div>
                <div class="filter-params-right">
                    <!-- <el-input 
                    class="fp-search"
                    v-model="filterParams.query" 
                    placeholder="请输入关键字"
                    clearable
                    size="small" 
                    @clear="queryChangeHandler"
                    @keyup.enter.native="queryChangeHandler">
                        <el-button class="fp-search-btn" slot="append" type="primary" size="small" @click="queryChangeHandler">搜索</el-button>
                    </el-input> -->
                    <div class="fp-search">
                        <CustomSearch  @search-change="queryChangeHandler"/>
                    </div>
                </div>
            </div>
        </div>
        <div class="ass-center">
            <div class="source-container" ref="scon"  v-if="enabledType != 'audio'">
                <AmSourceItem v-for="(item,index) in listDatas" :key="index" :parentWidth="scWidth" :order="index" :info="item" @selected="selectedHandler"/>
            </div>
            <div class="source-container" ref="scon"  v-if="enabledType == 'audio'">
                <AmAudioItem v-for="(item,index) in listDatas" :key="index" :info="item" @selected="selectedHandler"/>
            </div>
        </div>
        <div class="ass-bottom">

            <el-pagination
                @size-change="handleSizeChange"
                @current-change="handleCurrentChange"
                :current-page="filterParams.pageNum"
                :page-sizes="[10, 20, 30, 40, 60]"
                :page-size="filterParams.pageSize"
                layout="total,  prev, pager, next,sizes"
                :total="totalrecords">
            </el-pagination>
        </div>
    </div>
</template>

<script>
import AmSourceItem from './AmSourceItem';
import AmAudioItem from './AmAudioItem';
import CustomSearch from './components/CustomSearch';
import Utils from '../libs/Utils.js';
export default {
    name:'am-source-select',
    props:{
        enabledType:{
            type:String,
            default:'all,video,audio,image'
        },
        enabledRadio:{
            type:Boolean,
            default: false
        },
        propPageSize:{
            type:Number,
            default: 10
        }
        // returnData:{
        //     type:Object,
        //     default(){
        //         return {
        //             content:[],
        //             pageNum:1,
        //             pageSize:10,
        //             total:0
        //         }
        //     }
        // }
    },
    components:{
        AmSourceItem,
        AmAudioItem,
        CustomSearch
    },
    data (){
        return {
            typeSelectValue:0,
            typeOptions:[
                {
                    label:'全部类型',
                    value:0,
                    valueStr:'all',
                    disabled: false
                },
                {
                    label:'视频',
                    value:1,
                    valueStr:'video',
                    disabled: false
                },
                {
                    label:'音频',
                    value:2,
                    valueStr:'audio',
                    disabled: false
                },
                {
                    label:'图片',
                    value:3,
                    valueStr:'image',
                    disabled: false
                }
            ],
            duraSelectValue:0,
            duraOptions:[
                {
                    label:'全部时长',
                    value:0,
                    startDuration:'',
                    endDuration:'',
                    disabled: false
                },
                {
                    label:'超短(0-1分钟)',
                    value:1,
                    startDuration:'0',
                    endDuration:'60',
                    disabled: false
                },
                {
                    label:'短(1-10分钟)',
                    value:2,
                    startDuration:'60',
                    endDuration:'600',
                    disabled: false
                },
                {
                    label:'中(10-30分钟)',
                    value:3,
                    startDuration:'600',
                    endDuration:'1800',
                    disabled: false
                },
                {
                    label:'长(30分钟以上)',
                    value:4,
                    startDuration:'1800',
                    endDuration:'',
                    disabled: false
                },
                // Short, medium, long, super
            ],
            dateRange:[],
            pickerOptions: {
                shortcuts: [
                    {
                        text: '最近三天',
                        onClick(picker) {
                            const end = new Date();
                            const start = new Date();
                            start.setHours(0,0,0,0);
                            end.setHours(23,59,59,0);
                            start.setTime(start.getTime() - 3600 * 1000 * 24 * 3);
                            picker.$emit('pick', [start, end]);
                        }
                    }, 
                    {
                        text: '最近一周',
                        onClick(picker) {
                            const end = new Date();
                            const start = new Date();
                            start.setHours(0,0,0,0);
                            end.setHours(23,59,59,0);
                            start.setTime(start.getTime() - 3600 * 1000 * 24 * 7);
                            picker.$emit('pick', [start, end]);
                        }
                    }, {
                        text: '最近一个月',
                        onClick(picker) {
                            const end = new Date();
                            const start = new Date();
                            start.setHours(0,0,0,0);
                            end.setHours(23,59,59,0);
                            start.setTime(start.getTime() - 3600 * 1000 * 24 * 30);
                            picker.$emit('pick', [start, end]);
                        }
                    }
                ]
            },
            totalrecords:0,
            listDatas:[],
            scWidth:0,
            filterParams:{
                query:'',
                startDuration:'',
                endDuration:'',
                startTime:'',
                endTime:'',
                type:'',
                catalogId:'',
                pageNum:1,
                pageSize: 10, 
            }
        }
    },
    watch:{
        enabledType:{
            deep:true,
            handler(){
                this.enabledTypeChange();
            }
        }
    },
    created(){
        this.filterParams.pageSize = this.propPageSize;
        // const arr = [];
        // const arr2 = [
        //     {
        //         contentId:'sssssssssssss',
        //         title:'视频素材名称',
        //         preUrl:'http://unreal.top/works/H5Soplayer/temp/03000801005718A755ACAC003E880364E3768D-F2E6-C0A2-4ADB-2BDF39B4B223.mp4',
        //         cover:'http://unreal.top/images/photo/7.jpg',
        //         type:'video',
        //         path:'',
        //         duration: '60000',
        //         updateTime:'2020-06-02 11:04:12',
        //         width: '1920',
        //         height: '1080'
        //     },{
        //         contentId:'sssssssssssss',
        //         title:'音频素材名称',
        //         preUrl:'http://172.29.3.98:8000/media/audio/等一个晴天.mp3',
        //         cover:'http://unreal.top/images/photo/7.jpg',
        //         type:'audio',
        //         path:'',
        //         duration: '266700',
        //         updateTime:'2020-06-02 11:04:12',
        //         width: '0',
        //         height: '0'
        //     },{
        //         contentId:'iiiiiiiiiiiii',
        //         title:'图片素材名称',
        //         preUrl:'http://172.29.3.98:8000/media/image/5E5DC8F0FCBC431288AA008EAC110005.jpg',
        //         cover:'http://172.29.3.98:8000/media/image/5E5DC8F0FCBC431288AA008EAC110005.jpg',
        //         type:'image',
        //         path:'',
        //         duration: '0',
        //         updateTime:'2020-06-02 11:04:12',
        //         width: '1920',
        //         height: '1080'
        //     }
        // ]

        // for(let i=0;i<60;i++){
        //     let obj = Object.assign({},arr2[Math.floor(arr2.length*Math.random())]);
        //     obj.contentId = Utils.GUID();
        //     obj.isChecked = false;
        //     arr.push(obj)
        // }
        // console.log(JSON.stringify(arr));
        // this.listDatas = arr;
    },
    mounted (){
        const resizeObserver = new ResizeObserver(this.resizeChangeWH);
        resizeObserver.observe(this.$refs.scon);
        this.enabledTypeChange();
        
        // console.log('this.filterParams.sourceTypemountedmounted',this.filterParams)
    },
    methods:{
        resizeChangeWH(entries){
			// console.log(entries)
            for (let entry of entries) {
                if(entry.target == this.$refs.scon){
                    this.scWidth = entry.contentRect.width;
                    // console.log('this.scWidth',this.scWidth)
                }
            }
        },
        typeSelectHandler(value){
            this.filterParams.type = this.typeOptions[value].valueStr;
            if(this.filterParams.type == 'all') this.filterParams.type = '';
            // console.log('this.filterParams.sourceType',this.filterParams)
            this.$emit('flushList',this.filterParams);
        },
        duraSelectHandler(value){
            this.filterParams.startDuration = this.duraOptions[value].startDuration;
            this.filterParams.endDuration = this.duraOptions[value].endDuration;
            // console.log('this.filterParams.sourceType',this.filterParams,value)
            this.$emit('flushList',this.filterParams);
        },
        dateChangeHandler(value){
            if(value){
                this.filterParams.startTime = Utils.getFormatYYMMDD(value[0]);
                this.filterParams.endTime = Utils.getFormatYYMMDD(value[1]);
            }else{
                this.filterParams.startTime = '';
                this.filterParams.endTime = '';
            }
            this.$emit('flushList',this.filterParams);
            // console.log('dateChangeHandler',value,this.filterParams.startTime,this.filterParams.endTime)
        },
        queryChangeHandler(v){
            // console.log('this.filterParams.query',this.filterParams.query)
            this.filterParams.query = v;
            this.$emit('flushList',this.filterParams);
        },
        handleSizeChange(value){
            // console.log('handleSizeChange',value)
            this.filterParams.pageSize = value;
            this.$emit('flushList',this.filterParams);
        },
        handleCurrentChange(value){
            // console.log('handleCurrentChange',value)
            this.filterParams.pageNum = value;
            this.$emit('flushList',this.filterParams);
        },
        selectedHandler(info,value){
            if(this.enabledRadio && value){
                for(let i=0;i<this.listDatas.length;i++){
                    let item = this.listDatas[i];
                    item.isChecked = item.contentId == info.contentId;
                }
            }else{
                info.isChecked = value;
            }
        },
        enabledTypeChange(){
            for(let i=0;i<this.typeOptions.length;i++){
                this.typeOptions[i].disabled = !(this.enabledType.indexOf(this.typeOptions[i].valueStr)>-1);
            }
            for(let i=0;i<this.typeOptions.length;i++){
                if(!this.typeOptions[i].disabled){
                    this.typeSelectValue = this.typeOptions[i].value;
                    break;
                }
            }
            this.filterParams.type = this.typeOptions[this.typeSelectValue].valueStr;
            if(this.filterParams.type == 'all') this.filterParams.type = '';
            this.$emit('flushList',this.filterParams);
        },
        clearChecked(){
            for(let i=0;i<this.listDatas.length;i++){
                this.listDatas[i].isChecked = false;
            }
        },
        setReturnData(returnData){
            let sourcelist = returnData.content;
            for(let i=0;i<sourcelist.length;i++){
                let item = sourcelist[i];
                item.isChecked = false;
                if(item.cover){
                    item.cover = decodeURIComponent(item.cover);
                }
                if(item.preUrl){
                    item.preUrl = decodeURIComponent(item.preUrl);
                }
            }
            this.listDatas = sourcelist;
            this.totalrecords = parseInt(returnData.total);
            console.log('setReturnData',this.listDatas[0])
        },
        getSelectSource(){
            const arr = [];
            this.listDatas.forEach( item=>{
                if(item.isChecked){
                    arr.push(item);
                }
            })
            return arr;
        }
    }
}
</script>

<style lang="scss" scoped>
.am-source-select{
    width: 100%;
    height: 100%;
    padding: 20px;

    .ass-top{
        width: 100%;
        height: 40px;

        .ass-top-line2{
            width: 100%;
            height: 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;

            .filter-params-left{
                width: 100%;
                height: 100%;

                .fp-select{
                    width: 100px;
                    margin-right: 10px;
                }

                .fp-select2{
                    width: 140px;
                    margin-right: 10px;
                }

                .fp-date-picker{
                    width: 330px;

                    >:nth-child(3){
                        padding-right: 17px;
                    }
                }
            }

            .filter-params-right{
                // width: 100%;
                height: 100%;

                .fp-search{
                    width: 200px;
                }

                .fp-search-btn{
                    color: #ffffff;
                    background-color: #409EFF;
                    border: none;
                    border-top-left-radius: 0;
                    border-bottom-left-radius: 0;

                    &:hover{
                        background-color: #66b1ff;
                    }
                }
            }
        }
    }

    .ass-center{
        width: 100%;
        height: calc(100% - 100px);
        overflow: auto;
        margin: 10px 0px;

        .source-container{
            width: 100%;
            display: flex;
            flex-wrap: wrap;
        }
    }

    .ass-bottom{
        width: 100%;
        height: 40px;
        display: flex;
        justify-content: center;
        align-items: center;
    }
}
</style>
<style>
@keyframes audiowave {
    0%{
        transform: scaleY(0.4);
    }
    10%{
        transform: scaleY(0.3);
    }
    20%{
        transform: scaleY(0.8);
    }
    30%{
        transform: scaleY(0.7);
    }
    40%{
        transform: scaleY(0.2);
    }
    50%{
        transform: scaleY(0.6);
    }
    60%{
        transform: scaleY(0.1);
    }
    70%{
        transform: scaleY(0.9);
    }
    80%{
        transform: scaleY(0.8);
    }
    90%{
        transform: scaleY(0.4);
    }
    100%{
        transform: scaleY(1);
    }
}
</style>